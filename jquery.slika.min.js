/*! jQuery Slika | (c) 2014 | https://github.com/dlid/jquery-slika  */
window.slika=function(l,b){function w(a){var d=b(this).parent().data(m),c=b(this).data("tag");a.preventDefault();d.filter||(d.filter={tags:[]});a=b.inArray(c,d.filter.tags);-1!==a&&d.filter.tags.splice(a,1);q(d)}function x(){var a=b(this).data(m),d=b(this).val();a.filter||(a.filter={tags:[]});-1===b.inArray(d,a.filter.tags)&&a.filter.tags.push(d);q(a)}function q(a){var b,c="";for(b=0;b<a.filter.tags.length;b++)0<b&&(c+="/"),c+=encodeURIComponent(a.filter.tags[b]);a.config.useHash?document.location.hash=
"#!/"+c:a.refreshToolbar()}function y(a){var d=b.Deferred(),c=[],f=[],g=[],h=[];if(a.filter.tags&&0<a.filter.tags.length){for(var e=0;e<a.filter.tags.length;e++){for(var k=0;k<a.tags.images[a.filter.tags[e]].length;k++)-1===b.inArray(a.tags.images[a.filter.tags[e]][k],f)&&f.push(a.tags.images[a.filter.tags[e]][k]);c.push(a.tags.images[a.filter.tags[e]])}b(a.jqImageElements).addClass("slika-temp-hidden");for(e=0;e<f.length;e++){for(var l=0,k=0;k<c.length;k++)-1!==b.inArray(f[e],c[k])&&l++;l===c.length&&
(g.push(f[e]),b(a.jqImageElements[f[e]]).removeClass("slika-temp-hidden"))}b(a.jqImageElements).filter(".slika-temp-hidden").fadeOut();b(a.jqImageElements).not(".slika-temp-hidden").fadeIn();for(e=0;e<g.length;e++)for(k=0;k<a.tags.imageTags[g[e]].length;k++)-1===b.inArray(a.tags.imageTags[g[e]][k],h)&&-1===b.inArray(a.tags.imageTags[g[e]][k],a.filter.tags)&&h.push(a.tags.imageTags[g[e]][k])}else h=a.tags.names,b(a.jqImageElements).fadeIn();a.jqFilterElement.css("visibility","hidden").empty();h.sort();
a.jqTagList.find("option").not(":nth-child(1)").remove();for(e=0;e<h.length;e++)a.jqTagList.append(b("<option>").text(h[e]).val(h[e]));a.jqTagList.find("option").first().attr("selected","selected");for(e=0;e<a.filter.tags.length;e++)a.jqFilterElement.append(b("<a>").data("tag",a.filter.tags[e]).attr("href","#"+a.filter.tags[e]).text(a.filter.tags[e]).append(b("<span>").text("x")));a.jqFilterElement.css("visibility","visible");d.resolve();return d}function r(a,d){function c(){var a=null;0==g.find(".highlight").length?
a=g.find("span").first():(a=g.find(".highlight").next(),g.find(".highlight").removeClass("highlight").css(p));a.css(z).addClass("highlight");setTimeout(function(){g.hasClass("loader-active")&&c()},150)}var f=b.Deferred(),g=b("#"+a);g.addClass("loader-active").find("span").css(p).end().fadeIn().css("display","inline-block");c();d.done(function(){g.removeClass("loader-active").find("span").removeClass("highlight").css(p).end().fadeOut(100,function(){f.resolve()})});return f}function s(){t++;return b("<span>").attr("id",
"slikaloader"+t).addClass("slika-ui-loader").html("<span>.</span><span>.</span><span>.</span>")}function u(){function a(){d++;2==d&&(b(".slika-ui-lightbox").remove(),b(".slika-ui-overlay").remove())}var d=0;b(".slika-ui-lightbox").fadeOut("fast",a);b(".slika-ui-overlay").fadeOut("fast",a)}function v(a){var d=b(l).width(),c=b(l).height(),f=b(a).width(),g=b(a).height();a.css({left:d/2-f/2+"px",top:c/2-g/2+"px"})}function A(a){a.preventDefault();var d=b(this).closest(".slika-ui-wrapper").data(m),c=b(".slika-ui-lightbox");
b("<span>").addClass("slika-ui-close").text("x");var f=b(this).parent().attr("href"),g=b(this).attr("title");0==c.length&&(c=b("<div>").addClass("slika-ui-lightbox").hide(),b("body").append(c));b("<div>").addClass("slika-ui-overlay").appendTo("body").click(u);a=s();c.empty().addClass("slika-image").css({padding:"10px",width:"100px",height:"40px",textAlign:"center",backgroundColor:"transparent",left:100,top:100,position:"fixed"}).append(a).show();v(c);var h=new Image;r(a.attr("id"),function(a){var c=
b.Deferred();h.onload=function(){c.resolve()};h.src=f;return c}()).done(function(){h.width>b(l).width()&&(h.width=b(l).width()-.2*b(l).width());h.height>b(l).height()&&(h.height=b(l).height()-.2*b(l).height());c.css("visibility","hidden").append(h);var a=b("<div>").addClass("slika-ui-lightbox-toolbar").append(b("<span>").addClass("slika-ui-title").text(g)).append(b("<a>").addClass("slika-ui-nav close").html(d.config.closeText)).width(b(h).width());c.prepend(a).on("click",".slika-ui-nav",function(){b(this).hasClass("close")&&
u()});c.css({backgroundColor:"#000",width:"auto",height:"auto"});v(c);c.css("visibility","visible").hide().fadeIn()})}function B(a){var d={},c,f,g=[],h=[];a.jqImageElements.each(function(e){b(this).addClass(a);c=b(this).data("slikaTags");h[e]=[];if(c&&"object"===typeof c&&"[object Array]"==Object.prototype.toString.call(c))for(f=0;f<c.length;f++)void 0===d[c[f]]&&(d[c[f]]=[],g.push(c[f])),h[e].push(c[f]),d[c[f]].push(e)});g.sort();a.tags={names:g,images:d,imageTags:h}}var n=function(a,d){this.version=
"0.1";this.jqElement=b(a);this.jqElement.data(m,this);this.jqToolbarElement=this.jqContainerElement=this.jqWrapperElement=null;this.options=d;this.metadata=this.jqElement.data("slika");this.jqImageElements=null;this.tags={}},t=0,m="slika",p={fontWeight:"normal"},z={fontWeight:"bold"};n.prototype={defaults:{useHash:!0,selectText:"Filter by tag",closeText:"x"},init:function(){var a=this;this.config=b.extend(!0,{},this.defaults,n.globals,this.options);this.jqImageElements=this.jqElement.find("a img");
B(this);this.jqElement.on("click","a img",A);this.jqToolbarElement=b("<div>").css("visibility","hidden").addClass("slika-ui-toolbar");this.jqFilterElement=b("<div>").css("visibility","hidden").addClass("slika-ui-filter").data(m,this);this.jqWrapperElement=b("<div>").addClass("slika-ui-wrapper").data(m,this);this.jqContainerElement=b("<div>").addClass("slika-ui-container");this.jqWrapperElement.insertBefore(this.jqElement);this.jqWrapperElement.data(m,this).append(this.jqFilterElement).append(this.jqToolbarElement).append(this.jqContainerElement);
this.jqElement.appendTo(this.jqContainerElement);this.jqTagList=b("<select>").addClass("slika-ui-tag-list");this.jqTagList.append(b("<option>").text(this.config.selectText));for(var d=0;d<this.tags.names.length;d++)this.jqTagList.append(b("<option>").text(this.tags.names[d]).val(this.tags.names[d]));this.jqToolbarElement.append(b("<span>").addClass("slika-ui-tags").append(this.jqTagList)).append(s().hide());this.jqToolbarElement.css("visibility","visible").hide().fadeIn("slow");this.jqFilterElement.on("click",
"a",w);this.jqTagList.data(m,this).on("change",x);this.config.useHash&&0===document.location.hash.indexOf("#!/")&&(this.jqImageElements.hide(),b(l).on("hashchange",function(b){a.refreshFromHash()}),this.refreshFromHash())},setFilter:function(a){if("string"===typeof a){a=a.split("/");for(var d=[],c,f=0;f<a.length;f++)(c=b.trim(decodeURIComponent(a[f])))&&d.push(c);this.filter={tags:d};this.refreshToolbar()}},refreshFromHash:function(a,b){0===document.location.hash.indexOf("#!/")?(document.location.hash.substr(3),
this.setFilter(document.location.hash.substr(3))):(this.filter={tags:[]},this.refreshToolbar())},refreshToolbar:function(){var a=this.jqToolbarElement,b=this.jqTagList;b.attr("disabled","disabled");r(a.find(".slika-ui-loader").attr("id"),y(this)).then(function(){b.removeAttr("disabled")})}};b.fn.slika=function(a){if(n.prototype[a]){if(b(this).data(m))return n.prototype[a].apply(b(this),Array.prototype.slice.call(arguments,1))}else{if("object"===typeof a||!a)return this.each(function(){if(b(this).data(m))return this;
(new n(this,a||{})).init()});b.error("No method "+a+" in slika")}};n.globals=b.extend({},l.slika);return n}(window,jQuery);