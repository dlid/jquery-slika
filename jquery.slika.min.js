/*! jQuery Slika | (c) 2014 | https://github.com/dlid/jquery-slika  */
window.slika=function(l,b){function q(a){var b,d="";for(b=0;b<a.filter.tags.length;b+=1)0<b&&(d+="/"),d+=encodeURIComponent(a.filter.tags[b]);a.config.useHash?document.location.hash="#!/"+d:a.refreshToolbar()}function v(){var a=b(this).data("slika"),e=b(this).val();a.filter||(a.filter={tags:[]});-1===b.inArray(e,a.filter.tags)&&a.filter.tags.push(e);q(a)}function w(a){var e=b(this).parent().data("slika"),d=b(this).data("tag");a.preventDefault();e.filter||(e.filter={tags:[]});a=b.inArray(d,e.filter.tags);
-1!==a&&e.filter.tags.splice(a,1);q(e)}function r(a,e){function d(){g=null;0===h.find(".highlight").length?g=h.find("span").first():(g=h.find(".highlight").next(),h.find(".highlight").removeClass("highlight").css(n));g.css(x).addClass("highlight");setTimeout(function(){h.hasClass("loader-active")&&d()},150)}var f=b.Deferred(),h=b("#"+a),g;h.addClass("loader-active").find("span").css(n).end().fadeIn().css("display","inline-block");d();e.done(function(){h.removeClass("loader-active").find("span").removeClass("highlight").css(n).end().fadeOut(100,
function(){f.resolve()})});return f}function s(){p+=1;return b("<span>").attr("id","slikaloader"+p).addClass("slika-ui-loader").html("<span>.</span><span>.</span><span>.</span>")}function t(){function a(){e+=1;2===e&&(b(".slika-ui-lightbox").remove(),b(".slika-ui-overlay").remove())}var e=0;b(".slika-ui-lightbox").fadeOut("fast",a);b(".slika-ui-overlay").fadeOut("fast",a)}function u(a){var e=b(l).width(),d=b(l).height(),f=b(a).width(),h=b(a).height();a.css({left:e/2-f/2+"px",top:d/2-h/2+"px"})}function y(a){var e=
{},d,f,h=[],g=[];a.jqImageElements.each(function(c){b(this).addClass(a);d=b(this).data("slikaTags");g[c]=[];if(d&&"object"===typeof d&&"[object Array]"===Object.prototype.toString.call(d))for(f=0;f<d.length;f+=1)void 0===e[d[f]]&&(e[d[f]]=[],h.push(d[f])),g[c].push(d[f]),e[d[f]].push(c)});h.sort();a.tags={names:h,images:e,imageTags:g}}function z(a){a.preventDefault();var e=b(this).closest(".slika-ui-wrapper").data("slika"),d=b(".slika-ui-lightbox"),f=b(this).parent().attr("href"),h=b(this).attr("title"),
g,c,k;0===d.length&&(d=b("<div>").addClass("slika-ui-lightbox").hide(),b("body").append(d));b("<div>").addClass("slika-ui-overlay").appendTo("body").click(t);a=s();d.empty().addClass("slika-image").css({padding:"10px",width:"100px",height:"40px",textAlign:"center",backgroundColor:"transparent",left:100,top:100,position:"fixed"}).append(a).show();u(d);g=new Image;r(a.attr("id"),function(){c=b.Deferred();g.onload=function(){c.resolve()};g.src=f;return c}()).done(function(){g.width>b(l).width()&&(g.width=
b(l).width()-.2*b(l).width());g.height>b(l).height()&&(g.height=b(l).height()-.2*b(l).height());d.css("visibility","hidden").append(g);k=b("<div>").addClass("slika-ui-lightbox-toolbar").append(b("<span>").addClass("slika-ui-title").text(h)).append(b("<a>").addClass("slika-ui-nav close").html(e.config.closeText)).width(b(g).width());d.prepend(k).on("click",".slika-ui-nav",function(){b(this).hasClass("close")&&t()});d.css({backgroundColor:"#000",width:"auto",height:"auto"});u(d);d.css("visibility",
"visible").hide().fadeIn()})}function A(a){var e=b.Deferred(),d=[],f=[],h=[],g=[],c,k,l;if(a.filter.tags&&0<a.filter.tags.length){for(c=0;c<a.filter.tags.length;c+=1){for(k=0;k<a.tags.images[a.filter.tags[c]].length;k+=1)-1===b.inArray(a.tags.images[a.filter.tags[c]][k],f)&&f.push(a.tags.images[a.filter.tags[c]][k]);d.push(a.tags.images[a.filter.tags[c]])}b(a.jqImageElements).addClass("slika-temp-hidden");for(c=0;c<f.length;c+=1){for(k=l=0;k<d.length;k+=1)-1!==b.inArray(f[c],d[k])&&(l+=1);l===d.length&&
(h.push(f[c]),b(a.jqImageElements[f[c]]).removeClass("slika-temp-hidden"))}b(a.jqImageElements).filter(".slika-temp-hidden").fadeOut();b(a.jqImageElements).not(".slika-temp-hidden").fadeIn();for(c=0;c<h.length;c+=1)for(k=0;k<a.tags.imageTags[h[c]].length;k+=1)-1===b.inArray(a.tags.imageTags[h[c]][k],g)&&-1===b.inArray(a.tags.imageTags[h[c]][k],a.filter.tags)&&g.push(a.tags.imageTags[h[c]][k])}else g=a.tags.names,b(a.jqImageElements).fadeIn();a.jqFilterElement.css("visibility","hidden").empty();g.sort();
a.jqTagList.find("option").not(":nth-child(1)").remove();for(c=0;c<g.length;c+=1)a.jqTagList.append(b("<option>").text(g[c]).val(g[c]));a.jqTagList.find("option").first().attr("selected","selected");for(c=0;c<a.filter.tags.length;c+=1)a.jqFilterElement.append(b("<a>").data("tag",a.filter.tags[c]).attr("href","#"+a.filter.tags[c]).text(a.filter.tags[c]).append(b("<span>").text("x")));a.jqFilterElement.css("visibility","visible");e.resolve();return e}var m=function(a,e){this.version="0.1";this.jqElement=
b(a);this.jqElement.data("slika",this);this.jqToolbarElement=this.jqContainerElement=this.jqWrapperElement=null;this.options=e;this.metadata=this.jqElement.data("slika");this.jqImageElements=null;this.tags={}},p=0,n={fontWeight:"normal"},x={fontWeight:"bold"};m.prototype={defaults:{useHash:!0,selectText:"Filter by tag",closeText:"x"},init:function(){var a=this,e;this.config=b.extend(!0,{},this.defaults,m.globals,this.options);this.jqImageElements=this.jqElement.find("a img");y(this);this.jqElement.on("click",
"a img",z);this.jqToolbarElement=b("<div>").css("visibility","hidden").addClass("slika-ui-toolbar");this.jqFilterElement=b("<div>").css("visibility","hidden").addClass("slika-ui-filter").data("slika",this);this.jqWrapperElement=b("<div>").addClass("slika-ui-wrapper").data("slika",this);this.jqContainerElement=b("<div>").addClass("slika-ui-container");this.jqWrapperElement.insertBefore(this.jqElement);this.jqWrapperElement.data("slika",this).append(this.jqFilterElement).append(this.jqToolbarElement).append(this.jqContainerElement);
this.jqElement.appendTo(this.jqContainerElement);this.jqTagList=b("<select>").addClass("slika-ui-tag-list");this.jqTagList.append(b("<option>").text(this.config.selectText));for(e=0;e<this.tags.names.length;e+=1)this.jqTagList.append(b("<option>").text(this.tags.names[e]).val(this.tags.names[e]));this.jqToolbarElement.append(b("<span>").addClass("slika-ui-tags").append(this.jqTagList)).append(s().hide()).css("visibility","visible").hide().fadeIn("slow");this.jqFilterElement.on("click","a",w);this.jqTagList.data("slika",
this).on("change",v);this.config.useHash&&(0===document.location.hash.indexOf("#!/")&&this.jqImageElements.hide(),b(l).on("hashchange",function(){a.refreshFromHash()}),this.refreshFromHash())},setFilter:function(a){if("string"===typeof a){a=a.split("/");var e=[],d,f;for(f=0;f<a.length;f+=1)(d=b.trim(decodeURIComponent(a[f])))&&e.push(d);this.filter={tags:e};this.refreshToolbar()}},refreshFromHash:function(){0===document.location.hash.indexOf("#!/")?this.setFilter(document.location.hash.substr(3)):
(this.filter={tags:[]},this.refreshToolbar())},refreshToolbar:function(){var a=this.jqToolbarElement,b=this.jqTagList;b.attr("disabled","disabled");r(a.find(".slika-ui-loader").attr("id"),A(this)).then(function(){b.removeAttr("disabled")})}};b.fn.slika=function(a){if(m.prototype[a]){if(b(this).data("slika"))return m.prototype[a].apply(b(this),Array.prototype.slice.call(arguments,1))}else{if("object"===typeof a||!a)return this.each(function(){return b(this).data("slika")?this:(new m(this,a||{})).init()});
b.error("No method "+a+" in slika")}};m.globals=b.extend({},l.slika);return m}(window,jQuery);